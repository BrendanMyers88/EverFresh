{% extends 'base.html' %}

{% load evergreen_helpers %}

{% block content %}

    <!-- CSS -->
    <style>
        h1 {
            alignment: center;
        }

        #product_name {
            font-weight: normal;
        }

        .food_item_row:hover {
            background-color: #f9f9f9;
            cursor: pointer;
        }

        .item.ui.segment:hover {
            background-color: #f1f1f1;
            cursor: pointer;
        }

        #qty_id input:focus + #qty_label, #qty_id input:focus {
            background-color: rgba(0, 255, 28, 0.06);
            border-color: rgba(41, 67, 32, 0.44);
        }

        .ui.form {
            margin-bottom: 10px;
        }

        .disabled {
            cursor: not-allowed;
        }

        #add_items {
            float: right;
            width: 10%;
        }
    </style>

    <!--Page Title-->
    <h1> {{ freshsheet.created_at }} Fresh Sheet </h1>


    <!--List View-->
    <form method="post" action="{% url "add_line_items_to_cart" %}" class="ui form">
        {% csrf_token %}
        <table class="ui unstackable compact celled definition table">
            <thead class="full-width">
            <tr>
                <th class="two wide left aligned">Product</th>
                <th class="two wide left aligned">Farm</th>
                <th class="two wide right aligned">Quantity</th>
                <th class="one wide right aligned">Current Quantity</th>
                <th class="one wide right aligned">Split Cost</th>
                <th class="one wide right aligned">Case Cost</th>
                <th class="one wide right aligned">Wholesale Cost</th>
            </tr>
            </thead>
            <tbody>
            {% for food_item in freshsheet.items.all|dictsort:"name" %}
                <tr onclick="$(this).find('input').focus()" class="food_item_row">
                    <td id="product_name">
                        {{ food_item.name }}
                    </td>
                    <td>
                       {{ food_item.farm }}
                    </td>
                    <td class="right aligned">
                        <div class="field">
                            <div id="qty_id" class="ui fluid right labeled input">
                                <input name="food_item_{{ food_item.pk }}" type="number" min="1"
                                       max="9999" class="right aligned">
                                <div id="qty_label" style="width: 5em;" class="ui right aligned basic label">
                                    {{ food_item.get_unit_verbose }}
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="right aligned">{{ cart_quantities|get_item:food_item.pk|default_if_none:'' }}</td>
                    <td class="right aligned">${{ food_item.price }}</td>
                    <td class="right aligned">${{ food_item.case_price }} ({{ food_item.case_count }}+)</td>
                    <td class="right aligned">${{ food_item.wholesale_price }} ({{ food_item.wholesale_count }}+)</td>
                </tr>
            {% endfor %}
            </tbody>
            <tfoot class="full-width">
            <tr>
                <th colspan="7">
                    {% if request.user.is_authenticated %}
                        <button value="{{ line.pk }}" id="add_items" class="tiny ui green fluid button">
                            Add to Cart
                        </button>
                    {% else %}
                        <a href="{% url "auth_login" %}" id="login_btn" class="tiny ui red fluid button">
                            You must login
                        </a>
                    {% endif %}
                </th>
            </tr>
            </tfoot>
        </table>
    </form>

    <script>

        $(document).ready(function () {
            $(".order-button").click(function (event) {
                // your add_quantity function stuff here
                var quantity = $(event.target).parent().find('input').val();
                $.get("/add_to_cart/" + this.dataset.itemId + "/" + quantity + "/" + "?freshsheet_pk={{ freshsheet.pk }}")
            })
        });
    </script>
{% endblock %}
